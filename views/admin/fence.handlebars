<style>#map {height: 500px;width: 100%;}</style>
<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">Geo Fence</h1>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Create New Geo Fence</h6>
        </div>
        
        <div class="card-body">
            <form class="user" action="/admin/home/geofence/create" method="post">
                <div class="form-group row">
                    <div class="col-md-5">
                        <input type="text" class="form-control form-control-user" name="fence" placeholder="Geo Fence Name" required>
                    </div>
                    <div class="col-md-5">
                        <select name="type" id="type" class="form-control" onchange="changeFence()">
                            <option value="1">Rectangle</option>
                            <option value="2">Circle</option>
                        </select>
                    </div>
                </div>
                <button id="submitBtn" type="submit" class="btn btn-primary btn-user btn-block">Create</button>
            </form>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Map</h6>
        </div>
        
        <div class="card-body">
            <div id="map"></div>
            <br>
            <button type="submit" class="btn btn-success btn-user btn-block">Create</button>
        </div>
    </div>
</div>
<script>

function initMap(){
    
    let mLocation = undefined;
    let map = undefined;
    let drawingManager = undefined;

    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition( position => {
            mLocation = {lat: position.coords.latitude, lng: position.coords.longitude};
            map = new google.maps.Map(document.getElementById('map'), {zoom: 18, center: mLocation});

            let all_overlays = [];
            let selectedShape;
            drawingManager = new google.maps.drawing.DrawingManager({
            drawingMode: google.maps.drawing.OverlayType.MARKER,
            drawingControl: true,
            drawingControlOptions: {
                position: google.maps.ControlPosition.TOP_CENTER,
                drawingModes: [
                    //google.maps.drawing.OverlayType.MARKER,
                    google.maps.drawing.OverlayType.CIRCLE,
                    //google.maps.drawing.OverlayType.POLYGON,
                    google.maps.drawing.OverlayType.RECTANGLE
                ]
            },
            circleOptions: {
                fillColor: '#4d72de',
                fillOpacity: 0.1,
                strokeWeight: 3,
                clickable: true,
                editable: true,
                zIndex: 1
            },
            rectangleOptions: {
                fillColor: '#4d72de',
                fillOpacity: 0.5,
                strokeWeight: 3,
                clickable: true,
                editable: true,
                zIndex: 1
            }
        });

        function clearFence() {
            if(selectedShape) {
                selectedShape.setEditable(false);
                selectedShape = null;
            }
        }

        function setFence(shape) {
            clearFence();
            selectedShape = shape;
            shape.setEditable(true);
        }

        function deleteSelectedFence() {
            if (selectedShape) {
                selectedShape.setMap(null);
                selectedShape = null;
            }
        }

        function deleteAllShape() {
            for (var i = 0; i < all_overlays.length; i++) {
                all_overlays[i].overlay.setMap(null);
            }
            all_overlays = [];
        }

        drawingManager.setMap(map);
        });
    } else {
        mLocation = { lat: 19.1175295, lng: 72.91651519999999 };
        map = new google.maps.Map(document.getElementById('map'), {zoom: 18, center: mLocation});
        drawingManager = new google.maps.drawing.DrawingManager({
            drawingMode: google.maps.drawing.OverlayType.MARKER,
            drawingControl: true,
            drawingControlOptions: {
                position: google.maps.ControlPosition.TOP_CENTER,
                drawingModes: [
                    //google.maps.drawing.OverlayType.MARKER,
                    google.maps.drawing.OverlayType.CIRCLE,
                    //google.maps.drawing.OverlayType.POLYGON,
                    google.maps.drawing.OverlayType.RECTANGLE
                ]
            },
            circleOptions: {
                fillColor: '#4d72de',
                fillOpacity: 0.5,
                strokeWeight: 3,
                clickable: true,
                editable: true,
                zIndex: 1
            },
            rectangleOptions: {
                fillColor: '#4d72de',
                fillOpacity: 0.5,
                strokeWeight: 3,
                clickable: true,
                editable: true,
                zIndex: 1
            }
        });
        drawingManager.setMap(map);
    }
}
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgAjjr1VNy4zJCZEz-6FgIdkH3SVBS6jA&callback=initMap&libraries=drawing"></script>
